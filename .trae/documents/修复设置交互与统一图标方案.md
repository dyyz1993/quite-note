## 目标

* 让 AI 设置页中的自定义滑块与所有按钮都可点击、可拖动，交互流畅。

* 热力图方格改为不透明填充，并加入细腻阴影，颜色与 note.jsx 保持一致。

* 引入 Lucide-Swift，保证 macOS 端图标与 note.jsx 图标集一致，并建立可维护的映射。

## 问题定位

* 滑块：当前 SwiftUI 手势在垂直 ScrollView 中可能被滚动手势抢占；轨道/覆盖层也可能拦截事件。

* 按钮：装饰性 overlay/background 没有禁用命中测试，导致点击事件被遮挡。

* 热力图：使用了半透明 white.opacity(...)，与需求“不透明”冲突。

* 图标：使用系统 SF Symbols，未与 Web 端 lucide-react 保持一致。

## 方案与改动点

### 1) 自定义滑块交互增强

* 用原生 `NSSlider` 封装为 `NSViewRepresentable`（命名：`NativeSlider`），确保拖动、点击跳转、连续更新在 macOS 上稳定：

  * 属性：`value: Binding<Double>`、`range: ClosedRange<Double>`、`step: Double?`、`onChange: ((Double)->Void)?`。

  * 事件处理：`isContinuous = true`，`target/action` 回调实时更新值。

  * 替换 AI/记录设置中的三处 `CustomSlider` 以保证交互可靠。

* 若保留当前 SwiftUI 版 `CustomSlider`：

  * 给轨道容器 `.frame(height: 16)` 并 `.contentShape(Rectangle())`。

  * 将 `DragGesture` 提升为 `.highPriorityGesture(...)`，避免 ScrollView 抢占。

  * 所有 `.overlay(...)` 与装饰 `.background(...)` 增加 `.allowsHitTesting(false)`。

### 2) 按钮可点击性修复

* 对以下视图的装饰层统一加 `.allowsHitTesting(false)`：

  * `SettingsOverlayView.swift` 中所有 `.overlay(RoundedRectangle(...).stroke(...))`；

  * Header/Tab 条的分隔线 `overlay(Rectangle().frame(...))`；

  * 记录设置区域的卡片背景/描边。

* 检查 `.buttonStyle(.plain)` 周围是否有 `ZStack` 上层元素覆盖；若有，给上层 `.allowsHitTesting(false)`。

### 3) 热力图不透明与阴影

* `HeatmapView.swift` 中颜色映射改为不透明填充，并加入与 note.jsx 对齐的绿系：

  * `count == 0` → `Color.themeGray700`；

  * `count < 3` → `Color.themeGreen900`；

  * `count < 8` → `Color.themeGreen600`；

  * 其他 → `Color.themeGreen400` + 阴影 `shadow(color: Color.themeGreen.opacity(0.6), radius: 4)`。

* Header 图标改为浅白色并保留柔和白色光晕：`foregroundColor(.white)` + `shadow(color: .white.opacity(0.5), radius: 4)`。

### 4) 引入 Lucide-Swift 并建立统一映射

* 安装：Xcode → File → Add Packages... → 粘贴 `https://github.com/JakubMazur/lucide-icons-swift` \[来源 1]；添加到 App target。

* 使用：

  * SwiftUI 加载图标：

    ```swift
    import LucideIconsSwift // 或 README 中的 LucideIcons
    Image(nsImage: NSImage.image(lucideId: "bluetooth")!)
    ```

  * 建立枚举映射（`IconName`），集中维护与 note.jsx 一致的图标名称（lucideId）：

    * `Activity` → `"activity"`

    * `Clipboard` → `"clipboard"`

    * `Settings` → `"settings"`

    * `ArrowLeft` → `"arrow-left"`

    * `Sparkles` → `"sparkles"`

    * `Bot` → `"bot"`

    * `Check` → `"check"`

    * `Save` → `"save"`

    * `FileText` → `"file-text"`

    * `AlignLeft` → `"align-left"`

    * `Trash2` → `"trash-2"`

    * `Star` → `"star"`

    * `Search` → `"search"`

    * `Minimize2` → `"minimize-2"`

    * `Maximize2` → `"maximize-2"`

    * `Database` → `"database"`

    * `Link` → `"link"`

    * `Zap` → `"zap"`

    * `Clock` → `"clock"`

    * `Bluetooth` → `"bluetooth"`

    * `BluetoothOff` → `"bluetooth-off"`

    * `BluetoothConnected` → `"bluetooth-connected"`（lucide 提供该图标，参见在线目录）

* 图标一致性检索：在 `lucide.dev/icons` 列表中核对所有名称 \[来源 5]；或用 `lucide-static` 的名称清单进行自动校验（构建时校验缺失图标）\[来源 3]。

### 5) Toast 一致化

* 统一使用 `store.postToast(message:type:)`，在设置页的导出/清空/保存操作中均触发，并保证顶部状态栏区域可见。

* 若 `RecordStore` 未实现该方法，则新增一个 `ToastCenter`（ObservableObject）在根视图注入，`SettingsOverlayView` 通过环境对象触发。

### 6) 验证用例（真实数据）

* 滑块：

  * 初始 `summaryLimit = 136`，拖到 200；确认数值变更并写入偏好（调用 `store.savePreferences()`）。

* 热力图：

  * 聚合最近 12 天计数：`[0,1,2,5,9,...]`；视觉检查四档颜色与阴影效果；点击某日筛选记录列表。

* 按钮：

  * 导出按钮弹出 Toast“导出功能正在开发中...”；清空按钮弹出 Toast“已清空所有记录”。

* 图标：

  * Header 蓝牙图标在 `connected/connecting/disconnected` 三态切换，名称来自 Lucide；点击跳转到蓝牙设置页签。

## 交付内容

* 更新 `SettingsOverlayView.swift`（禁用命中测试的 overlay、滑块替换/增强、按钮交互与 Toast）。

* 更新 `HeatmapView.swift`（不透明色值、阴影、Header 图标视觉微调）。

* 新增 `Icon.swift`（图标枚举与加载助手）与 `NativeSlider.swift`（NSSlider 封装）。

* 引入 SPM 依赖 `lucide-icons-swift` 并在工程中使用。

## 参考

* \[1] Lucide-Swift 仓库（SPM）：<https://github.com/JakubMazur/lucide-icons-swift>

* \[5] Lucide 图标目录：<https://lucide.dev/icons>

