## 思路总览
- 目标：在 Accessory 模式下，鼠标悬停到悬浮窗即切到 Regular 获取 KeyWindow；移开后自动切回 Accessory，保证无 Dock/平时不打扰。
- 同时修复拖拽：未锁定时全窗可拖拽，锁定时不可拖拽；避免 overlay 遮挡命中。

## 具体实现
1) 悬停聚焦（Hover→Regular）
- 在根视图最外层添加悬停监听：SwiftUI `.onHover { isHovering }`，或在 `NSHostingView` 添加 `NSTrackingArea`。
- 新增控制方法：`FloatingPanelController.requestRegularFocus(reason:)`：
  - 若当前 `NSApp.activationPolicy == .accessory` 且 `panel.isKeyWindow == false`，则：
    - `NSApp.setActivationPolicy(.regular)`
    - `NSApp.activate(ignoringOtherApps: true)`
    - `panel.makeKeyAndOrderFront(nil)` + `panel.orderFrontRegardless()`
    - 设置状态 `focusMode = .regularByHover`
- 悬停离开：`scheduleRevertToAccessory()`（延时 200-300ms，防抖）
  - 条件：`panel.isKeyWindow == false` 或者 `!isInteracting`（下面维护）
  - 执行：`NSApp.setActivationPolicy(.accessory)` + `panel.orderFrontRegardless()`。

2) 交互节流与稳定性
- 状态机：`hovering`、`isInteracting`（鼠标按下、输入框聚焦）、`lastSwitchAt`（时间戳）。
- 节流规则：两次 Policy 切换的最小间隔 500ms；悬停离开后若 300ms 内又回到悬停则取消回退（避免抖动）。
- 鼠标按下时（在窗口内 `mouseDown`），强制保持 Regular，`mouseUp` + 300ms 后再评估是否回退。

3) 拖拽修复
- 初始化：根据偏好 `PreferencesManager.shared.windowLock` 设置：
  - 未锁定：`panel.isMovableByWindowBackground = true`（全窗拖拽）
  - 锁定：`panel.isMovableByWindowBackground = false`
- 监听锁定切换：`onWindowLock` 中同步上述属性。
- 扩展拖拽命中：保持 Sidebar/Header 的 `WindowDragHandler`；全部装饰性 `overlay(Rectangle...)` 继续补 `.allowsHitTesting(false)`，避免遮挡拖拽。

4) 日志与排查
- 在 `didBecomeKey/didResignKey` 打印：`policy`、`level`、`isKey`、`isVisible`、`collectionBehavior`、`hovering/isInteracting`，用于定位切换不顺畅。
- 在 `requestRegularFocus` 与 `scheduleRevertToAccessory` 打印切换耗时与理由：`reason.hover`/`reason.click`。

5) 验证用例
- “悬停切换”：Accessory → 悬停至窗体 → 300ms 内切到 Regular 并成为 KeyWindow；移开 300ms 后回到 Accessory（无操作时）。
- “拖拽”：未锁定时，全窗背景可拖动；锁定后不可拖动。
- “输入门控”：KeyWindow 时输入可用；失焦禁用输入；日志显示状态正确。

## 代码改动点
- `FloatingPanelController`：新增 `requestRegularFocus(reason:)`、`scheduleRevertToAccessory()`、状态变量；初始化/锁定联动 `isMovableByWindowBackground`；优化 `ensureVisibleOnLaunch()` 的延时。
- `FloatingRootView` 或 `NSHostingView`：新增 `.onHover` 或 `NSTrackingArea`，以及鼠标按下/抬起交互标记。
- 日志：在 `didBecomeKey/didResignKey` 与切换方法中追加详细打印。

## 兼容性说明
- 保持 `.floating` 层级与 `.canJoinAllSpaces + .fullScreenAuxiliary`。
- Policy 切换已加节流与延时，减少 Dock 闪烁与视觉抖动。